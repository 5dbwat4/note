---
title: Attacks
---

# XS-Search

è·¨ç«™æœç´¢ï¼ˆXS-Searchï¼‰æ˜¯XS-Leaksæ”»å‡»å®¶æ—ä¸­çš„é‡è¦æ”»å‡»åŸç†ã€‚è¿™ç±»æ”»å‡»é€šè¿‡æ»¥ç”¨åŸºäºæŸ¥è¯¢çš„æœç´¢ç³»ç»Ÿï¼Œä»æ”»å‡»è€…æºç«™æ³„éœ²ç”¨æˆ·ä¿¡æ¯[^1][^2]ã€‚åŸå§‹æ”»å‡»åˆ©ç”¨æ—¶é—´æµ‹é‡æ¥åˆ¤æ–­æœç´¢ç³»ç»Ÿæ˜¯å¦è¿”å›ç»“æœï¼Œå…¶æµç¨‹å¦‚ä¸‹ï¼š

1. å»ºç«‹è¿”å›ç»“æœçš„è¯·æ±‚æ‰€éœ€æ—¶é—´åŸºå‡†ï¼ˆå‘½ä¸­ï¼‰ï¼Œä»¥åŠæ— ç»“æœè¿”å›çš„è¯·æ±‚æ‰€éœ€æ—¶é—´åŸºå‡†ï¼ˆæœªå‘½ä¸­ï¼‰ã€‚  
2. å¯¹æœç´¢æ¥å£å‘èµ·[è®¡æ—¶æ”»å‡»](#timing-attacks-network-timing)ï¼Œæš´åŠ›ç ´è§£é¦–å­—ç¬¦ï¼ˆå¦‚`?q=r`ï¼‰ã€‚  
3. è‹¥æµ‹é‡æ—¶é—´ä½äºå‘½ä¸­åŸºå‡†ï¼Œåˆ™è¿½åŠ å­—ç¬¦ï¼ˆå¦‚`?q=ra`ï¼‰ï¼›å¦åˆ™å°è¯•æ–°å­—ç¬¦ï¼ˆå¦‚`?q=s`ï¼‰ã€‚  
4. æœ€ç»ˆå¯æ³„éœ²å®Œæ•´æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚`?q=secret`ï¼‰ã€‚  

è¯¥æ”»å‡»éœ€å¤šæ¬¡è®¡æ—¶æµ‹é‡ä»¥æé«˜å‡†ç¡®æ€§ï¼Œå¯é€šè¿‡è†¨èƒ€æŠ€æœ¯å’Œç»Ÿè®¡åˆ†æä¼˜åŒ–ã€‚æ­¤å¤–ï¼Œæ”»å‡»è€…å¯ä¸é€å­—ç¬¦æš´åŠ›ç ´è§£ï¼Œè€Œæ˜¯æœç´¢ç‰¹å®šè¯è¯­æˆ–å¥å­æ¥ä»…æ£€æµ‹ç»“æœæ˜¯å¦å­˜åœ¨ã€‚

æ­¤æ”»å‡»çš„æ ¸å¿ƒä»·å€¼åœ¨äºå…¶åŸç†ï¼Œå› å…¶å¯åº”ç”¨äºå¤šç§ä¸åŒçš„XS-Leaksæ”»å‡»åœºæ™¯ã€‚

## è†¨èƒ€æŠ€æœ¯  
XS-Searchçš„è†¨èƒ€æŠ€æœ¯ç”¨äºæå‡æ”»å‡»ç²¾åº¦ï¼Œä½¿ä¸¤ç§å“åº”ç±»å‹ï¼ˆå‘½ä¸­/æœªå‘½ä¸­ï¼‰æ›´æ˜“åŒºåˆ†ã€‚ä»¥ä¸‹ä¸¤ç§æœºåˆ¶å¯ä¼˜åŒ–æµ‹é‡ï¼š  

- è‹¥æœç´¢ç³»ç»Ÿåœ¨è¿”å›ç»“æœæ—¶å°†æŸäº›GETå‚æ•°åå°„åˆ°å“åº”ä¸­ï¼Œå“åº”ä½“ç§¯ä¼šå¢å¤§ã€‚è¿™ä½¿å¾—è¯·æ±‚æ›´æ˜“åŒºåˆ†ï¼Œå› ä¸ºæœåŠ¡å™¨å‡†å¤‡å“åº”å’Œç½‘ç»œä¼ è¾“æ—¶é—´æ˜¾è‘—å¢åŠ ã€‚  
- å¼ºåˆ¶æœåŠ¡å™¨åœ¨è¿”å›å“åº”å‰æ‰§è¡Œæ›´å¤šè®¡ç®—ã€‚è¯¥æ–¹æ³•é€‚ç”¨äºæ”¯æŒæ›´å¤æ‚æŸ¥è¯¢è¯­è¨€çš„æœç´¢ç³»ç»Ÿï¼ˆä¾‹å¦‚Gmailä¸­æ’é™¤å…³é”®è¯éœ€å¤„ç†ç»“æœä¸­çš„æ¯ä¸ªå­—ç¬¦ï¼‰ã€‚  

## æ‰©å±•åŸç†  
å°½ç®¡XS-Searchçš„åŸå§‹ç ”ç©¶èšç„¦äºè®¡æ—¶æ”»å‡»ï¼Œä½†å…¶åŸç†å¯æ‰©å±•è‡³å…¶ä»–XS-Leaksã€‚æ”»å‡»è€…å¯ä¸ä¾èµ–ä¸å¯é çš„è®¡æ—¶æµ‹é‡ï¼Œè½¬è€Œåˆ©ç”¨å…¶ä»–XS-Leaksæå–ç›¸åŒä¿¡æ¯ã€‚  

åœ¨åŸºäºæŸ¥è¯¢çš„æœç´¢ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·æäº¤æŸ¥è¯¢å¹¶è·å–å…³è”å“åº”ï¼Œå¯èƒ½äº§ç”Ÿä¸¤ç§ç»“æœï¼š  
1. ç³»ç»Ÿæ˜¾ç¤ºç»“æœï¼Œé¡µé¢å‘ˆç°ç‰¹å®šè¡Œä¸ºï¼ˆçŠ¶æ€ä¸€ï¼‰ï¼›  
2. ç³»ç»Ÿæœªæ˜¾ç¤ºç»“æœï¼Œé¡µé¢è¡Œä¸ºä¸çŠ¶æ€ä¸€ä¸åŒï¼ˆçŠ¶æ€äºŒï¼‰ã€‚  

è‹¥ä¸Šè¿°ä¸¤ç§è¡Œä¸ºå¯é€šè¿‡æ¯”è®¡æ—¶æ›´å¯é çš„XS-LeakåŒºåˆ†ï¼Œæ”»å‡»è€…å³å¯å®æ–½æ›´é«˜æ•ˆçš„XS-Searchæ”»å‡»ã€‚ä¾‹å¦‚ï¼šè‹¥é¡µé¢æ¡†æ¶æ•°é‡éšæœç´¢ç»“æœå˜åŒ–ï¼ˆçŠ¶æ€ä¸€ä¸äºŒå¯åŒºåˆ†ï¼‰ï¼Œåˆ™å¯ç»“åˆ[æ¡†æ¶è®¡æ•°](#frame-counting) XS-Leakåº”ç”¨æ­¤æ”»å‡»åŸç†ï¼Œå…¶å‡†ç¡®æ€§å¯èƒ½ä¼˜äºè®¡æ—¶æµ‹é‡ã€‚  

## é˜²å¾¡æªæ–½  

| æ”»å‡»å˜ä½“         | [SameSite Cookies (Lax)](./defenses#opt-in-same-site-cookies) | [COOP](./defenses#opt-in-coop) | [æ¡†æ¶é˜²æŠ¤](./defenses#opt-in-xfo) |                                          [éš”ç¦»ç­–ç•¥](./defenses#isolation-policies)                                          |
| :--------------: | :--------------------------------------------------------------------------------: | :-------------------------------------------------: | :----------------------------------------------------: | :------------------------------------------------------------------------------------------------------------------------------------------: |
| XS-Searchï¼ˆè®¡æ—¶ï¼‰ |                                         âœ”ï¸                                          |                          âŒ                          |                           âŒ                            | [RIP](./defenses#isolation-policies-resource-isolation" >}}) ğŸ”— [NIP](./defenses#isolation-policies-navigation-isolation" >}}) |

ğŸ”— â€“ é˜²å¾¡æœºåˆ¶éœ€ç»„åˆä½¿ç”¨ä»¥åº”å¯¹ä¸åŒåœºæ™¯ã€‚  

## å‚è€ƒæ–‡çŒ®  
[^1]: ã€Šè·¨ç«™æœç´¢æ”»å‡»ã€‹ï¼Œ[é“¾æ¥](https://446h.cybersec.fun/xssearch.pdf)  
[^2]: ã€Šè·¨ç«™æœç´¢(XS-Search)æ”»å‡»ã€‹ï¼ŒHemi Leibowitzï¼ŒOWASP AppSec IL 2015ï¼Œ[é“¾æ¥](https://wiki.owasp.org/images/a/a7/AppSecIL2015_Cross-Site-Search-Attacks_HemiLeibowitz.pdf)ï¼ˆ[å¤‡æ¡£](https://web.archive.org/web/20231226222426/https://owasp.org/www-pdf-archive/AppSecIL2015_Cross-Site-Search-Attacks_HemiLeibowitz.pdf)ï¼‰  

# 

è‹¥é¡µé¢å°†å…¶ `opener` å±æ€§è®¾ç½®ä¸º `null` æˆ–æ ¹æ®ç”¨æˆ·çŠ¶æ€é‡‡ç”¨ [COOP]({{< ref "/docs/defenses/opt-in/coop.md" >}}) é˜²æŠ¤æœºåˆ¶ï¼Œæ”»å‡»è€…ä¾¿å¯æ¨æ–­è·¨ç«™ç‚¹çš„ç”¨æˆ·çŠ¶æ€ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡æ£€æŸ¥çª—å£å¼•ç”¨ï¼Œæ”»å‡»è€…åªéœ€åœ¨ iframeï¼ˆæˆ–æ–°çª—å£ï¼‰ä¸­æ‰“å¼€ä¸€ä¸ªä»…è®¤è¯ç”¨æˆ·å¯è®¿é—®çš„ç«¯ç‚¹ï¼Œå³å¯æ£€æµ‹ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ã€‚[è¿è¡Œæ¼”ç¤º](https://xsinator.com/testing.html#COOP%20Leak)

## ä»£ç ç‰‡æ®µ  
ä»¥ä¸‹ä»£ç æ¼”ç¤ºå¦‚ä½•æ£€æµ‹ `opener` å±æ€§æ˜¯å¦è¢«è®¾ä¸º `null`ï¼Œæˆ– [COOP](./defenses#opt-in-coop) æ ‡å¤´æ˜¯å¦å­˜åœ¨é `unsafe-none` çš„å€¼ã€‚æ­¤æ£€æµ‹é€‚ç”¨äº iframe å’Œæ–°çª—å£ã€‚

```javascript
// å®šä¹‰å­˜åœ¨æ¼æ´çš„URL
const v_url = 'https://example.org/profile';

const exploit = (url, new_window) => {
  let win;
  if(new_window) {
    // åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€URLï¼Œæ£€æµ‹win.openeræ˜¯å¦å—COOPå½±å“
    // æˆ–è¢«è®¾ä¸ºnull
    win = open(url);
  } else {
    // åˆ›å»ºiframeæ£€æµ‹openeræ˜¯å¦å®šä¹‰
    // è¯¥æ–¹æ³•ä¸é€‚ç”¨äºCOOPæ£€æµ‹æˆ–å·²å¯ç”¨æ¡†æ¶é˜²æŠ¤çš„é¡µé¢
    document.body.insertAdjacentHTML('beforeend', '<iframe name="xsleaks">'); 
    // å°†iframeé‡å®šå‘è‡³ç›®æ ‡URL
    win = open(url, "xsleaks");
  }
  
  // ç­‰å¾…2ç§’ç¡®ä¿é¡µé¢åŠ è½½
  setTimeout(() => {
    if (win.closed) {
      console.log("openerå·²å…³é—­");
    } else {
      // æ£€æµ‹æ–°çª—å£çš„openerå±æ€§
      if(!win.opener) console.log("win.openerä¸ºnull");
      else console.log("win.openerå·²å®šä¹‰");
    }
  }, 2000);
}
exploit(v_url);
exploit(v_url, 1);
```

## é˜²å¾¡æªæ–½  
ç¼“è§£æ­¤ç±»XS-Leakéœ€ä¿æŒé¡µé¢è¡Œä¸ºä¸€è‡´æ€§ï¼š  
- **ç»Ÿä¸€COOPé…ç½®**ï¼šæ‰€æœ‰é¡µé¢åº”è®¾ç½®ç›¸åŒçš„ `opener` å±æ€§å€¼  
- **é¿å…JSåŠ¨æ€è®¾ç½®**ï¼šé€šè¿‡JavaScriptè®¾ç½® `opener` ä¸º `null` å¯èƒ½å­˜åœ¨è¾¹ç•Œæƒ…å†µï¼Œå› ä¸ºiframeçš„sandboxå±æ€§å¯å®Œå…¨ç¦ç”¨JavaScript  

